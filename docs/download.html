<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Redirecting to Windows 11 ISO</title>
</head>
<body>
  <h2>Redirecting to the latest Windows 11 ISO...</h2>
  <p>If your browser does not redirect automatically, <a id="link" href="#">click here</a>.</p>

  <script>
    fetch('https://raw.githubusercontent.com/knockfreely/win11-install-and-optimize/main/data/win11_info.json')
      .then(res => res.json())
      .then(data => {
        const downloadUrl = data.download_link;

        // 设置备用点击链接
        const link = document.getElementById('link');
        link.href = downloadUrl;

        // 尝试在新窗口打开下载
        const newWin = window.open(downloadUrl, '_blank');
        if (newWin) {
          newWin.focus();
          try {
            // 尝试关闭当前窗口
            window.close();
          } catch (err) {
            console.warn('Cannot close window:', err);
            // 保留页面给用户手动点击
          }
        } else {
          // 新窗口被阻止，用户可以点击备用链接
          console.warn('Popup blocked, user must click the link manually.');
        }
      })
      .catch(err => {
        console.error('Failed to load download link:', err);
        document.body.innerHTML = "<h2>Failed to load download link. Please try again later.</h2>";
      });
  </script>
</body>
