name: Update Windows ISO Links

on:
  workflow_dispatch:  # 手动触发

jobs:
  fetch-fido:
    runs-on: windows-latest

    steps:
      # 1. 检出自己的仓库
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. 下载最新 Fido.ps1
      - name: Download Fido.ps1
        run: |
          Invoke-WebRequest -Uri "https://raw.githubusercontent.com/pbatard/Fido/master/Fido.ps1" -OutFile "Fido.ps1"

      # 3. 执行 Fido.ps1 并把输出保存到文件
      - name: Run Fido.ps1 and save output
        shell: pwsh
        run: |
          Write-Host "Fetching Windows 11 ISO link..."
          $link = & ".\Fido.ps1" -Win 'Windows 11' -Rel Latest -Ed 'Windows 11 Home/Pro/Edu' -Lang English -Arch x64 -GetUrl
          Write-Host "Got link: $link"
          $link | Out-File -FilePath "windows_iso_links.txt" -Encoding UTF8

      # 4. 提交更新到仓库
      - name: Commit and push
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Update Windows 11 ISO link via Fido"
          file_pattern: "windows_iso_links.txt"
